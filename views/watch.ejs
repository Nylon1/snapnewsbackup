<!DOCTYPE html>
<html lang="en">
<head>
<script src="https://cdn.tailwindcss.com"></script>
  <title><%= video.title %> | SnapShnap</title>
  <meta property="og:type" content="video.other" />
  <meta property="og:url" content="https://www.snapshnap.com/watch/<%= video.friendly_token %>" />
  <meta property="og:title" content="<%= video.title %>" />
  <meta property="og:description" content="<%= video.description || 'Watch and share news instantly on SnapShnap.' %>" />
  <meta property="og:image" content="<%= video.thumbnail_url.startsWith('http') ? video.thumbnail_url : ('https://mediacms-cw-u46015.vm.elestio.app' + video.thumbnail_url) %>" />
  <meta property="og:video" content="<%= video.file %>" />
  <meta property="og:video:type" content="<%= video.mimeType || 'video/mp4' %>" />
  <meta property="og:video:width" content="640" />
  <meta property="og:video:height" content="360" />

  <!-- Twitter Card tags -->
  <meta name="twitter:card" content="player">
  <meta name="twitter:title" content="<%= video.title %>" />
  <meta name="twitter:description" content="<%= video.description || 'Watch and share news instantly on SnapShnap.' %>" />
  <meta name="twitter:image" content="<%= video.thumbnail_url.startsWith('http') ? video.thumbnail_url : ('https://mediacms-cw-u46015.vm.elestio.app' + video.thumbnail_url) %>" />
  <meta name="twitter:player" content="<%= video.file %>" />
  <meta name="twitter:player:width" content="640" />
  <meta name="twitter:player:height" content="360" />
</head>

<body class="bg-black text-white min-h-screen flex flex-col items-center justify-center">

<%
  // Robust video selection
  let videoUrl = null;
  let encodings = video.encodings_info || {};
  let order = ["720", "480", "360", "240"];
  for (let q of order) {
    if (encodings[q] && encodings[q].h264 && encodings[q].h264.url) {
      videoUrl = encodings[q].h264.url.startsWith('http')
        ? encodings[q].h264.url
        : 'https://mediacms-cw-u46015.vm.elestio.app' + encodings[q].h264.url;
      break;
    }
  }
  // fallback: original file
  if (!videoUrl && video.original_media_url) {
    videoUrl = video.original_media_url.startsWith('http')
      ? video.original_media_url
      : 'https://mediacms-cw-u46015.vm.elestio.app' + video.original_media_url;
  }
  // Thumbnail
  let thumbUrl = video.thumbnail_url
    ? (video.thumbnail_url.startsWith('http')
        ? video.thumbnail_url
        : 'https://mediacms-cw-u46015.vm.elestio.app' + video.thumbnail_url)
    : '';
%>

  <div class="w-full max-w-xl bg-gray-900 rounded-lg shadow-lg p-8 mt-10">
    <div class="mb-5">
      <video class="w-full rounded shadow-lg" controls autoplay poster="<%= thumbUrl %>">
        <source src="<%= videoUrl %>" type="video/mp4">
        Sorry, your browser doesn't support embedded videos.
      </video>
    </div>
    <h2 class="text-xl font-bold text-yellow-400 mb-1"><%= video.title || 'Untitled Snap' %></h2>
    <div class="text-gray-300 text-sm mb-4">
      Uploaded by <span class="font-semibold"><%= video.user?.username || video.user || 'Anonymous' %></span>
      · <%= new Date(video.created_at).toLocaleString() %>
    </div>
    <% if (video.description) { %>
      <div class="mb-4 text-gray-200"><%= video.description %></div>
    <% } %>
    <div class="text-xs text-yellow-400 mb-4">#snapnews</div>
    <a href="/feed" class="bg-yellow-400 text-black px-4 py-2 rounded font-semibold hover:bg-yellow-300 transition">← Back to Feed</a>
  </div>
</body>
</html>
