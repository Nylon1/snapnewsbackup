<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title><%= video.title %> | SnapShnap</title>

    <% 
      // Base URL for relative paths
      const MEDIA_BASE_URL = 'https://mediacms-cw-u46015.vm.elestio.app';

      // === Compute og:image safely ===
      let ogImage = '';
      if (video.thumbnail_url) {
        if (video.thumbnail_url.startsWith('http')) {
          ogImage = video.thumbnail_url;
        } else {
          ogImage = MEDIA_BASE_URL + video.thumbnail_url;
        }
      }

      // === Compute og:video safely ===
      let ogVideoUrl = '';
      if (video.file) {
        if (video.file.startsWith('http')) {
          ogVideoUrl = video.file;
        } else {
          ogVideoUrl = MEDIA_BASE_URL + video.file;
        }
      } else {
        // If you expected an 'encodings_info' field instead of video.file, you could fallback to that here.
        // For example, you might have computed video.videoUrl in the route and simply use:
        //    ogVideoUrl = video.videoUrl || '';
      }
    %>

    <!-- Open Graph tags -->
    <meta property="og:type"        content="video.other" />
    <meta property="og:url"         content="https://www.snapshnap.com/watch/<%= video.id %>" />
    <meta property="og:title"       content="<%= video.title %>" />
    <meta property="og:description" content="<%= video.description || 'Watch and share news on SnapShnap.' %>" />
    <meta property="og:image"       content="<%= ogImage %>" />
    <meta property="og:video"       content="<%= ogVideoUrl %>" />
    <meta property="og:video:type"  content="video/mp4" />
    <meta property="og:video:width" content="640" />
    <meta property="og:video:height"content="360" />

    <!-- Twitter Card tags -->
    <meta name="twitter:card"        content="player" />
    <meta name="twitter:title"       content="<%= video.title %>" />
    <meta name="twitter:description" content="<%= video.description || 'Watch and share news on SnapShnap.' %>" />
    <meta name="twitter:image"       content="<%= ogImage %>" />
    <meta name="twitter:player"      content="<%= ogVideoUrl %>" />
    <meta name="twitter:player:width"  content="640" />
    <meta name="twitter:player:height" content="360" />

    <style>
      @keyframes glow {
        0%, 100% { opacity: 0.72; filter: blur(16px); }
        50%      { opacity: 1;    filter: blur(32px); }
      }
      .animate-glow {
        animation: glow 2.8s infinite alternate cubic-bezier(.4,2.2,.3,1);
      }
      @keyframes cardpop {
        0%   { transform: scale(1); }
        50%  { transform: scale(1.025); }
        100% { transform: scale(1); }
      }
      .animate-glow-card {
        animation: cardpop 2.8s infinite alternate cubic-bezier(.4,2.2,.3,1);
      }
    </style>
  </head>

  <body class="bg-black text-white min-h-screen flex flex-col items-center justify-center">
    <% 
      // If you want to choose the "best" encoded video quality from encodings_info,
      // you could compute 'video.videoUrl' in your route. For now, if ogVideoUrl is empty,
      // we simply won't show a playable <video> tag below, or we fallback to 'videoUrl':
      const vidSrc = video.videoUrl || ogVideoUrl;
      const thumb = video.thumbnail_url && video.thumbnail_url.startsWith('http')
        ? video.thumbnail_url
        : video.thumbnail_url ? MEDIA_BASE_URL + video.thumbnail_url : '';
    %>

    <div class="w-full max-w-xl bg-gray-900 rounded-lg shadow-lg p-8 mt-10">
      <div class="mb-5">
        <video class="w-full rounded shadow-lg"
               controls
               autoplay
               poster="<%= thumb %>">
          <% if (vidSrc) { %>
            <source src="<%= vidSrc %>" type="video/mp4" />
          <% } %>
          Sorry, your browser doesn’t support embedded videos.
        </video>
      </div>

      <h2 class="text-xl font-bold text-yellow-400 mb-1"><%= video.title %></h2>
      <div class="text-gray-300 text-sm mb-4">
        Uploaded by 
        <span class="font-semibold"><%= video.user?.username %></span>
        &middot; <%= video.created_at ? video.created_at.toLocaleString() : '' %>
      </div>

      <% if (video.description) { %>
        <div class="mb-4 text-gray-200"><%= video.description %></div>
      <% } %>

      <div class="text-xs text-yellow-400 mb-4">#snapnews</div>
      <a href="/feed"
         class="bg-yellow-400 text-black px-4 py-2 rounded font-semibold hover:bg-yellow-300 transition">
        ← Back to Feed
      </a>
    </div>
  </body>
</html>



